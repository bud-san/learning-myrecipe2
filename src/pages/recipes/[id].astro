---
import BaseLayout from '../../layouts/BaseLayout.astro'
import Header from '../../components/Header.astro'
import IngredientsSection from '../../components/IngredientsSection.astro'
import StepsSection from '../../components/StepsSection.astro'
import type { Recipe } from '../../lib/microcms'
import { fetchAllRecipes } from '../../lib/microcms'

export async function getStaticPaths() {
  const recipes = await fetchAllRecipes()
  return recipes.map((recipe) => ({
    params: { id: recipe.id },
    props: { recipe },
  }))
}

const { recipe } = Astro.props as { recipe: Recipe }
---

<BaseLayout title={`${recipe.title} - RecipeHub`}>
  <Header />
  <main class="flex-1 flex flex-col items-center w-full">
    <div class="w-full max-w-[1200px] px-4 md:px-8 py-8 space-y-6">
      <section class="card p-6 md:p-8 space-y-4">
        <div class="flex flex-col gap-3">
          <div class="flex flex-wrap gap-2">
            {(recipe.cooking ?? []).map((item) => (
              <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/40 dark:text-orange-200">
                {item}
              </span>
            ))}
          </div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-[-0.02em]">{recipe.title}</h1>
          {recipe.description && <p class="text-base text-[#896861] dark:text-[#a08d89] leading-relaxed whitespace-pre-wrap">{recipe.description}</p>}
        </div>
        <div class="flex flex-wrap gap-3 text-sm text-[#896861] dark:text-[#a08d89]">
          <div class="inline-flex items-center gap-1.5">
            <span class="material-symbols-outlined text-[18px]">schedule</span>
            <span>更新 {new Intl.DateTimeFormat('ja-JP').format(new Date(recipe.updatedAt))}</span>
          </div>
          {recipe.servings && (
            <div class="inline-flex items-center gap-1.5">
              <span class="material-symbols-outlined text-[18px]">restaurant</span>
              <span>分量 {recipe.servings}</span>
            </div>
          )}
        </div>
        {recipe.ai && (
          <div class="rounded-2xl bg-primary/5 border border-primary/20 p-4 space-y-2">
            <div class="flex items-center gap-2 text-primary font-semibold">
              <span class="material-symbols-outlined">psychology</span>
              <span>AI評価</span>
            </div>
            <p class="text-sm text-[#181211] dark:text-white leading-relaxed whitespace-pre-wrap">{recipe.ai}</p>
          </div>
        )}
        {recipe.report && (
          <div class="rounded-2xl bg-white/70 dark:bg-[#2f1f1c] border border-[#e6dddb] dark:border-[#3e2d2a] p-4 space-y-2">
            <div class="flex items-center gap-2 text-[#181211] dark:text-white font-semibold">
              <span class="material-symbols-outlined">note_alt</span>
              <span>作ったメモ</span>
            </div>
            <p class="text-sm text-[#181211] dark:text-white leading-relaxed whitespace-pre-wrap">{recipe.report}</p>
          </div>
        )}
      </section>

      <div class="grid grid-cols-1 md:grid-cols-[1fr_360px] gap-6 items-start">
        <StepsSection steps={recipe.steps ?? []} />
        <IngredientsSection ingredients={recipe.ingredients ?? []} />
      </div>
    </div>
  </main>
</BaseLayout>
